<div id="waveform">
  <!-- Waveform goes in here -->
</div>

<script type="text/javascript">
var data = <%= @track.waveform_json %>;
data = data.filter(function(datum, index){
    return index % 3 == 0;
});
           
var width      = 710,
    height     = 120,
    svg        = d3
        .select(document.getElementById('waveform'))
        .append('svg')
        .attr('class', 'waveform')
        .attr('width', width)
        .attr('height', height);
           
svg
    .selectAll('rect')
    .data(data.map(function(datum){
        return (datum * height)/2;
    }))
    .enter()
    .append('rect')
    .attr('x', function(d, i){
        return i * (width / data.length);
    })
    .attr('y', function(d){
        return (height /2) - d ;
    })
    .attr('width', '4px')
    .attr('height', function(d){
        return d*2;
    })
    .attr('fill', 'steelblue')
    .on("mouseover", function(d) {
          //Get this bar's x/y values, then augment for the tooltip
          var xPosition = parseFloat(d3.select(this).attr("x"));
          var yPosition = parseFloat(d3.select(this).attr("y"));
          
          //Create the tooltip label
          svg.append("text")
             .attr("id", "tooltip")
             .attr("x", xPosition)
             .attr("y", yPosition)
             .attr("text-anchor", "middle")
             .attr("font-family", "sans-serif")
             .attr("font-size", "11px")
             .attr("font-weight", "bold")
             .attr("fill", "black")
             .text(data[0])
         })
         .on("mouseout", function() {
         
          //Remove the tooltip
          d3.select("#tooltip").remove();
          
         })
</script>
